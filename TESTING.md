# 字幕转换工具测试系统

## 概述

本项目包含了一个全面的字幕转换测试系统，使用**字符串模板**而非文件进行测试，确保核心转换功能的正确性。

## 测试特点

### ✅ 无需测试文件
- 所有测试都使用内置的字符串模板
- 避免了维护大量测试文件的复杂性
- 测试数据精确可控

### ✅ 全面的测试覆盖
- **解析测试**: 验证 SRT、VTT、ASS 三种格式的解析正确性
- **转换测试**: 测试所有格式间的相互转换 (6种组合)
- **边界情况测试**: 空内容、无效内容、特殊字符、长文本、极短时间

### ✅ 详细的测试报告
- 实时显示每个测试的通过/失败状态
- 统计总体成功率
- 列出失败测试的详细信息

## 运行测试

### 方法一：使用脚本（推荐）

**macOS/Linux:**
```bash
./run-tests.sh
```

**Windows:**
```batch
run-tests.bat
```

### 方法二：直接命令行

```bash
# 编译项目（如需要）
dotnet build

# 运行测试
dotnet run -- --test
```

## 测试内容详解

### 1. 解析测试
测试每种格式的字符串模板能否正确解析：

- **SRT模板**: 3个字幕条目，包含多行文本和特殊字符
- **VTT模板**: 标准WebVTT格式，验证WEBVTT头和时间格式
- **ASS模板**: 完整ASS结构，包含样式标签处理

### 2. 转换测试
验证所有格式间的相互转换：

```
SRT ⟷ VTT ⟷ ASS
```

每次转换都会验证：
- 转换是否成功完成
- 输出格式是否正确
- 内容是否保持一致

### 3. 边界情况测试

| 测试项 | 目的 |
|--------|------|
| 空内容测试 | 确保空字符串被正确识别为无效 |
| 无效内容测试 | 确保随机文本不会被误识别为字幕 |
| 特殊字符测试 | 验证中文、日文、emoji、HTML实体的处理 |
| 长文本测试 | 测试超长字幕文本的处理能力 |
| 极短时间测试 | 验证毫秒级和边界时间的处理 |

## 测试模板示例

### SRT格式模板
```srt
1
00:00:01,000 --> 00:00:03,000
Hello, this is a test subtitle.

2
00:00:04,500 --> 00:00:07,200
This is the second line with
multiple lines of text.

3
00:01:00,000 --> 00:01:02,500
Final subtitle with special chars: äöü &amp; éñ
```

### VTT格式模板
```vtt
WEBVTT

00:00:01.000 --> 00:00:03.000
Hello, this is a VTT test subtitle.

00:00:04.500 --> 00:00:07.200
This is the second line with
multiple lines of text.

00:01:00.000 --> 00:01:02.500
Final VTT subtitle with special chars: äöü & éñ
```

### ASS格式模板
包含完整的ASS文件结构：
- `[Script Info]` 部分
- `[V4+ Styles]` 样式定义
- `[Events]` 字幕事件
- 样式标签处理（如 `{\i1}italic{\i0}`）

## 测试结果解读

### 成功示例
```
✅ PASS | SRT → VTT 转换: 转换成功
✅ PASS | 特殊字符测试: 特殊字符处理成功
```

### 测试报告
```
📊 测试报告
=============
总测试数: 14
通过: 14
失败: 0
成功率: 100.0%

🎉 所有测试都通过了！
```

## 扩展测试

如需添加新的测试场景，可以在 `SubtitleTestRunner.cs` 中：

1. 创建新的测试方法
2. 添加对应的字符串模板
3. 在 `RunAllTestsAsync()` 中调用

## 故障排除

### 编译错误
确保已安装 .NET 9 SDK：
```bash
dotnet --version
```

### 权限错误 (macOS/Linux)
给脚本添加执行权限：
```bash
chmod +x run-tests.sh
```

### 字符编码问题
确保终端支持 UTF-8 编码以正确显示测试结果中的特殊字符。

## 测试设计理念

这个测试系统遵循以下设计原则：

1. **简单性**: 无需外部文件，一键运行
2. **完整性**: 覆盖所有核心功能和边界情况  
3. **可维护性**: 字符串模板易于修改和扩展
4. **清晰性**: 详细的测试报告和错误信息
5. **实用性**: 快速验证转换功能的正确性

通过这个测试系统，您可以确信字幕转换工具的核心功能完全可靠！ 